var Canvas2Image=function(){var t,e,i=(t=document.createElement("canvas"),{canvas:!!(e=t.getContext("2d")),imageData:!!e.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa});function u(t,e,n){var a=t.width,r=t.height;null==e&&(e=a),null==n&&(n=r);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e,o.height=n,i.drawImage(t,0,0,a,r,0,0,e,n),o}function c(t,e,n,a){return(t=u(t,n,a)).toDataURL(e)}function g(t,e){var n=document.createElement("a");n.href=t,n.download=e;var a=new MouseEvent("click",{bubbles:!1,cancelable:!1});n.dispatchEvent(a)}function o(t){var e=document.createElement("img");return e.src=t,e}function f(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function w(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function d(t){var e=t.width,n=t.height;return t.getContext("2d").getImageData(0,0,e,n)}function m(t,e){return"data:"+e+";base64,"+t}var v=function(t){var e=t.width,n=t.height,a=e*n*3,r=a+54,o=[66,77,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],i=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=(4-3*e%4)%4,c=t.data,g="",f=e<<2,d=n,m=String.fromCharCode;do{for(var v=f*(d-1),l="",s=0;s<e;s++){var h=s<<2;l+=m(c[v+h+2])+m(c[v+h+1])+m(c[v+h])}for(var p=0;p<u;p++)l+=String.fromCharCode(0);g+=l}while(--d);return w(o.concat(i))+w(g)},r=function(t,e,n,a,r){if(i.canvas&&i.dataURL)if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),r=null==r||0===r.length?Date.now()+"."+a:r+"."+a,a=f(a),/bmp/.test(a)){var o=d(u(t,e,n));g(m(v(o),downloadMimedownloadMime),r)}else{g(c(t,a,e,n).replace(a,"image/octet-stream"),r)}},a=function(t,e,n,a){if(i.canvas&&i.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),a=f(a),/bmp/.test(a)){var r=d(u(t,e,n));return o(m(v(r),"image/bmp"))}return o(c(t,a,e,n))}};return{saveAsImage:r,saveAsPNG:function(t,e,n,a){return r(t,e,n,"png",a)},saveAsJPEG:function(t,e,n,a){return r(t,e,n,"jpeg",a)},saveAsGIF:function(t,e,n,a){return r(t,e,n,"gif",a)},saveAsBMP:function(t,e,n,a){return r(t,e,n,"bmp",a)},convertToImage:a,convertToPNG:function(t,e,n){return a(t,e,n,"png")},convertToJPEG:function(t,e,n){return a(t,e,n,"jpeg")},convertToGIF:function(t,e,n){return a(t,e,n,"gif")},convertToBMP:function(t,e,n){return a(t,e,n,"bmp")}}}();
